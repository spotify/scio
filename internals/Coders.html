<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Scio - Documentation">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Scio - Documentation">
<link rel="shortcut icon" href="../images/favicon.ico">
<title>Coder Typeclass Â· Scio</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
data-md-color-primary="white"
data-md-color-accent="indigo"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Scio" class="md-header-nav__button md-logo">
<img src="../images/logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Scio
</span>
<span class="md-header-nav__topic">
Coder Typeclass
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/spotify/scio"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
spotify/scio
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Scio" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../images/logo.png" width="24" height="24">
</a>
<a href="../index.html" title="Scio">
Scio
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/spotify/scio"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
spotify/scio
</div>
</a>

</div>
<ul>
  <li><a href="../Getting-Started.html" class="page">Getting Started</a></li>
  <li><a href="../Builtin.html" class="page">Built-in Functionality</a></li>
  <li><a href="../Joins.html" class="page">Joins</a></li>
  <li><a href="../SideInputs.html" class="page">Side Inputs</a></li>
  <li><a href="../io/index.html" class="page">IO</a>
  <ul>
    <li><a href="../io/Avro.html" class="page">Avro</a></li>
    <li><a href="../io/Binary.html" class="page">Binary</a></li>
    <li><a href="../io/BigQuery.html" class="page">BigQuery</a></li>
    <li><a href="../io/Bigtable.html" class="page">Bigtable</a></li>
    <li><a href="../io/Cassandra.html" class="page">Cassandra</a></li>
    <li><a href="../io/Csv.html" class="page">CSV</a></li>
    <li><a href="../io/Datastore.html" class="page">Datastore</a></li>
    <li><a href="../io/Grpc.html" class="page">GRPC</a></li>
    <li><a href="../io/Elasticsearch.html" class="page">Elasticsearch</a></li>
    <li><a href="../io/Jdbc.html" class="page">JDBC</a></li>
    <li><a href="../io/Json.html" class="page">Json</a></li>
    <li><a href="../io/Neo4J.html" class="page">Neo4J</a></li>
    <li><a href="../io/Object.html" class="page">Object file</a></li>
    <li><a href="../io/Parquet.html" class="page">Parquet</a></li>
    <li><a href="../io/Protobuf.html" class="page">Protobuf</a></li>
    <li><a href="../io/Pubsub.html" class="page">PubSub</a></li>
    <li><a href="../io/ReadFiles.html" class="page">ReadFiles</a></li>
    <li><a href="../io/Redis.html" class="page">Redis</a></li>
    <li><a href="../io/Spanner.html" class="page">Spanner</a></li>
    <li><a href="../io/Tensorflow.html" class="page">Tensorflow</a></li>
    <li><a href="../io/Text.html" class="page">Text</a></li>
  </ul></li>
  <li><a href="../examples.html" class="page">Examples</a></li>
  <li><a href="../Scio-Unit-Tests.html" class="page">Testing</a></li>
  <li><a href="../internals/index.html" class="page">Internals</a>
  <ul>
    <li><a href="../internals/Coders.html" class="active page">Coder Typeclass</a></li>
    <li><a href="../internals/Kryo.html" class="page">Kryo</a></li>
    <li><a href="../internals/OverrideTypeProvider.html" class="page">OverrideTypeProvider</a></li>
    <li><a href="../internals/ScioIO.html" class="page">ScioIO</a></li>
  </ul></li>
  <li><a href="../extras/index.html" class="page">Extras</a>
  <ul>
    <li><a href="../extras/Algebird.html" class="page">Algebird</a></li>
    <li><a href="../extras/Annoy.html" class="page">Annoy</a></li>
    <li><a href="../extras/AsyncDoFn.html" class="page">AsyncDoFn</a></li>
    <li><a href="../extras/BigQueryAvro.html" class="page">BigQueryAvro</a></li>
    <li><a href="../extras/DistCache.html" class="page">DistCache</a></li>
    <li><a href="../extras/Fanout.html" class="page">Fanout</a></li>
    <li><a href="../extras/HyperLogLog.html" class="page">HyperLogLog</a></li>
    <li><a href="../extras/MutableScalableBloomFilter.html" class="page">MutableScalableBloomFilter</a></li>
    <li><a href="../extras/Sorter.html" class="page">Sorter</a></li>
    <li><a href="../extras/Sort-Merge-Bucket.html" class="page">Sort Merge Bucket</a></li>
    <li><a href="../extras/Sparkey.html" class="page">Sparkey</a></li>
    <li><a href="../extras/Scio-REPL.html" class="page">REPL</a></li>
    <li><a href="../extras/Transforms.html" class="page">Transforms</a></li>
    <li><a href="../extras/Voyager.html" class="page">Voyager</a></li>
  </ul></li>
  <li><a href="../dev/index.html" class="page">Development</a>
  <ul>
    <li><a href="../dev/build.html" class="page">Build</a></li>
    <li><a href="../dev/Style-Guide.html" class="page">Style Guide</a></li>
    <li><a href="../dev/How-to-Release.html" class="page">How to Release</a></li>
    <li><a href="../dev/Design-Philosophy.html" class="page">Design Philosophy</a></li>
    <li><a href="../dev/Scala-Steward.html" class="page">Scala Steward</a></li>
  </ul></li>
  <li><a href="../scaladoc.html" class="page">Scaladoc</a></li>
  <li><a href="../Scio,-Scalding-and-Spark.html" class="page">Scio, Spark and Scalding</a></li>
  <li><a href="../Runners.html" class="page">Runners</a></li>
  <li><a href="../Scio-data-guideline.html" class="page">Data Guidelines</a></li>
  <li><a href="../releases/index.html" class="page">Releases</a>
  <ul>
    <li><a href="../releases/Apache-Beam.html" class="page">Apache Beam Compatibility</a></li>
    <li><a href="../releases/migrations/index.html" class="page">Migration Guides</a></li>
    <li><a href="../releases/breaking-changes.html" class="page">Breaking Changelog</a></li>
    <li><a href="../releases/v0.12.0.html" class="page">v0.12.0 Release Blog</a></li>
  </ul></li>
  <li><a href="../FAQ.html" class="page">FAQ</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../internals/Coders.html#coder-typeclass" class="header">Coder Typeclass</a>
  <ul>
    <li><a href="../internals/Coders.html#coder-in-apache-beam" class="header"><code>Coder</code> in Apache Beam</a></li>
    <li><a href="../internals/Coders.html#compiler-flags-and-warnings" class="header">Compiler flags and warnings</a></li>
    <li><a href="../internals/Coders.html#how-to-build-a-custom-coder" class="header">How to build a custom Coder</a></li>
    <li><a href="../internals/Coders.html#null-values-support" class="header">Null values support</a></li>
    <li><a href="../internals/Coders.html#upgrading-to-v0-7-0-or-above-migrating-to-static-coder" class="header">Upgrading to <code>v0.7.0</code> or above: Migrating to static coder</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.14.18-23-19528e8-20250827T172948Z*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../internals/Coders.html#coder-typeclass" class="header">Coder Typeclass</a>
  <ul>
    <li><a href="../internals/Coders.html#coder-in-apache-beam" class="header"><code>Coder</code> in Apache Beam</a></li>
    <li><a href="../internals/Coders.html#compiler-flags-and-warnings" class="header">Compiler flags and warnings</a></li>
    <li><a href="../internals/Coders.html#how-to-build-a-custom-coder" class="header">How to build a custom Coder</a></li>
    <li><a href="../internals/Coders.html#null-values-support" class="header">Null values support</a></li>
    <li><a href="../internals/Coders.html#upgrading-to-v0-7-0-or-above-migrating-to-static-coder" class="header">Upgrading to <code>v0.7.0</code> or above: Migrating to static coder</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#coder-typeclass" name="coder-typeclass" class="anchor"><span class="anchor-link"></span></a>Coder Typeclass</h1>
<h2><a href="#coder-in-apache-beam" name="coder-in-apache-beam" class="anchor"><span class="anchor-link"></span></a><code>Coder</code> in Apache Beam</h2>
<p>As per <a href="https://beam.apache.org/documentation/programming-guide/#specifying-coders">Beam&rsquo;s documentation</a></p>
<blockquote>
  <p>When Beam runners execute your pipeline, they often need to materialize the intermediate data in your PCollections, which requires converting elements to and from byte strings. The Beam SDKs use objects called Coders to describe how the elements of a given PCollection may be encoded and decoded.</p>
</blockquote>
<p>For the most part, coders are used when Beam transfer intermediate data between workers over the network. They may also be used by beam to test instances for equality. Anytime you create an <code>SCollection[T]</code>, Beam needs to know how to go from an instance of <code>T</code> to an array of bytes, and from that array of bytes to an instance of <code>T</code>.</p>
<p>The Beam SDK defines a class called <code>Coder</code> that roughly looks like this:</p>
<pre class="prettyprint"><code class="language-java">public abstract class Coder&lt;T&gt; implements Serializable {
  public abstract void encode(T value, OutputStream outStream);
  public abstract T decode(InputStream inStream);
}
</code></pre>
<p>Beam provides built-in Coders for various basic Java types (<code>Integer</code>, <code>Long</code>, <code>Double</code>, etc.). But anytime you create a new class, and that class is used in an <code>SCollection</code>, a beam coder needs to be provided.</p>
<pre class="prettyprint"><code class="language-scala mdoc:silent">import com.spotify.scio.values.SCollection

case class Foo(x: Int, s: String)
def coll: SCollection[Foo] = ??? // Beam will need an org.apache.beam.sdk.coders.Coder[Foo]
</code></pre>
<h3><a href="#when-are-coder-used-" name="when-are-coder-used-" class="anchor"><span class="anchor-link"></span></a>When are <code>Coder</code> used ?</h3>
<h4><a href="#shuffling-data" name="shuffling-data" class="anchor"><span class="anchor-link"></span></a>Shuffling data</h4>
<p>Whenever intermediate data is shuffled, Beam will need to serialize and deserialize that data to transfer it between workers. In Scio any <code>*byKey</code> (<code>groupByKey</code>, <code>reduceByKey</code>, etc.) transform will trigger a shuffle.</p>
<h4><a href="#cluster-scaling-up-and-down" name="cluster-scaling-up-and-down" class="anchor"><span class="anchor-link"></span></a>Cluster scaling up and down</h4>
<p>When the runner scales up and down your cluster size, data needs to be redistributed between workers. Beam therefore needs to transfer data over the network, which means serializing and deserializing it by using <code>Coder</code>.</p>
<h4><a href="#groupbykey" name="groupbykey" class="anchor"><span class="anchor-link"></span></a>GroupByKey</h4>
<p>Grouping by key uses <code>Coder</code> for two reasons: First, as we have already seen, GBK triggers a shuffle, and therefore go through a serialization / deserialization cycle.</p>
<p>Second, grouping elements by key means that Beam needs to compare them and be able to decide whether two instances are equal. In Beam, and in the context of a <code>groupByKey</code> (or any <code>*byKey</code> operation), the equality of keys is tested by comparing their serialized form.</p>
<p>Let&rsquo;s say we have defined a class <code>Identifier</code> and we use it as the key in a <code>groupByKey</code> transform:</p>
<pre class="prettyprint"><code class="language-scala">import com.spotify.scio.values.SCollection

val coll: SCollection[(Identifier, Foo)] = ???
val grouped: SCollection[(Identifier, Iterable[Foo])] = coll.groupByKey()
</code></pre>
<p>To decide whether two instances of <code>Identifier</code> <code>id1</code> and <code>id2</code> are equal, Beam will compare them after serialization. For example:</p>
<pre class="prettyprint"><code class="language-scala">// (pseudo-code)
coder.encode(id1) // 00010011
coder.encode(id2) // 00010010
// -&gt; i1 and i2 are NOT equal
</code></pre>
<p><strong>When they are used to test equality, coders are required to be deterministic.</strong> If a non-deterministic <code>Coder</code> is used to test equality, an exception is thrown:</p>
<pre class="prettyprint"><code class="language-scala mdoc:reset:invisible">import com.spotify.scio.ScioContext
val sc = ScioContext.forTest()
</code></pre>
<pre class="prettyprint"><code class="language-scala mdoc:crash">val grouped =
  sc.parallelize(List((1.2, &quot;foo&quot;), (42.5, &quot;bar&quot;), (1.2, &quot;baz&quot;)))
    .groupByKey
sc.run()
</code></pre>
<h3><a href="#scio-coder-vs-beam-coder" name="scio-coder-vs-beam-coder" class="anchor"><span class="anchor-link"></span></a>Scio <code>Coder</code> vs Beam <code>Coder</code></h3>
<p>Both Scio and Beam define a class called <code>Coder</code>. For the most part when writing a job, you will be interacting with <code>com.spotify.scio.coders.Coder</code>.</p>
<p>Scio <code>Coder</code> and its implementations simply form an <a href="https://en.wikipedia.org/wiki/Algebraic_data_type">ADT</a> where each implementation is a building block that covers one of the possible cases:</p>
<ul>
  <li><code>Beam</code>: a simple wrapper around a Beam Coder</li>
  <li><code>Singleton</code>: A coder for a static object. It is for example used to serialize <code>Unit</code>.</li>
  <li><code>Disjunction</code>: Represent a Coder that makes a choice between different possible implementations. It is for example used to serialize ADTs and <code>Either</code></li>
  <li><code>Record</code>: A Coder for record-like structures like case classes and tuples.</li>
  <li><code>Transform</code>: A Coder implemented by &ldquo;transforming&rdquo; the encoded/decoded value of another Coder.</li>
  <li><code>CoderTransform</code>: A Coder implemented by &ldquo;transforming&rdquo; a Beam Coder to a new Coder.</li>
  <li><code>Fallback</code>: A default <code>Coder</code>. Used when there is no better option.</li>
</ul>
<p>There is also a &ldquo;special&rdquo; coder called <code>KVCoder</code>. It is a specific coder for Key-Value pairs. Internally Beam treats <a href="https://beam.apache.org/releases/javadoc/2.67.0/?org/apache/beam/sdk/values/KV.html" title="org.apache.beam.sdk.values.KV"><code>KV</code></a> differently from other types so Scio needs to do the same.</p>
<p>It is important to note that <strong>Scio&rsquo;s coders are only representations</strong> of those cases but <strong>do not actually implement any serialization logic</strong>. Before the job starts, those coders will be <em>materialized</em>, meaning they will be converted to instances of <a href="https://beam.apache.org/releases/javadoc/2.67.0/?org/apache/beam/sdk/coders/Coder.html" title="org.apache.beam.sdk.coders.Coder"><code>org.apache.beam.sdk.coders.Coder</code></a>. Thanks to this technique, Scio can dynamically change the behavior of coders depending on the execution context. For example coders may handle nullable values differently depending on options passed to the job.</p>
<p><a href="https://beam.apache.org/releases/javadoc/2.67.0/?org/apache/beam/sdk/coders/Coder.html" title="org.apache.beam.sdk.coders.Coder"><code>org.apache.beam.sdk.coders.Coder</code></a> instances on the other hand are the actual implementations of serialization and deserialization logic. Among other thing, each instance of <code>org.apache.beam.sdk.coders.Coder[T]</code> defines two methods:</p>
<pre class="prettyprint"><code class="language-scala">class ExampleCoder extends org.apache.beam.sdk.coders.Coder[Example] {
  def decode(inStream: InputStream): Example = ???
  def encode(value: Example, outStream: OutputStream): Unit = ???
}
</code></pre>
<h3><a href="#how-scio-picks-a-coder-instance" name="how-scio-picks-a-coder-instance" class="anchor"><span class="anchor-link"></span></a>How Scio picks a Coder instance</h3>
<p>Every method in Scio that may potentially need to serialize and deserialize data takes an <a href="https://docs.scala-lang.org/tour/implicit-parameters.html">implicit</a> <code>Coder</code> argument. See for example the definition of <code>SCollection.map</code>:</p>
<pre class="prettyprint"><code class="language-scala">def map[U: Coder](f: T =&gt; U): SCollection[U] = // implementation
//           â
//    Implicit Coder[U] lookup
</code></pre>
<p>This type signature means the following: The method <code>map</code> (defined in <code>SCollection[T]</code>), applied to a function from <code>T</code> to <code>U</code>, will return an <code>SCollection[U]</code>. On top of that this method has a <em>context bound</em> <code>U: Coder</code>, meaning a <code>Coder[U]</code> needs to be available in the implicit context.</p>
<p>So <strong>at compile time</strong> the Scala compiler will try to find an appropriate <code>Coder</code>. If it fails to find one, the compilation will fail.</p>
<p>When the compiler looks for an implicit for a concrete type <code>Foo</code>, three cases can happen:</p>
<h4><a href="#there-exist-an-coder-foo-in-scope" name="there-exist-an-coder-foo-in-scope" class="anchor"><span class="anchor-link"></span></a>There exist an <code>Coder[Foo]</code> in scope</h4>
<p>Scio comes with a number of implementation for common types like primitives (<code>Int</code>, <code>Float</code>, <code>String</code>, etc.), common Scala and Java types (<code>Option</code>, <code>Either</code>, <code>List</code>, etc.) and some types from the Beam API. In that case the available <code>Coder</code> will simply be used. It is also possible for the user (aka you) to provide an implementation. Here&rsquo;s an example REPL session that demonstrate it:</p>
<pre class="prettyprint"><code class="language-scala mdoc">import com.spotify.scio.coders._
Coder[Int] // Try to find a Coder instance for Int
</code></pre>
<p>Here the compiler just found a proper Coder for integers. Scio also provides Coders for commons collections types:</p>
<pre class="prettyprint"><code class="language-scala mdoc">Coder[List[String]] // Try to find a Coder instance for List[String]
</code></pre>
<h4><a href="#no-coder-foo-is-available-but-the-compiler-can-derive-one" name="no-coder-foo-is-available-but-the-compiler-can-derive-one" class="anchor"><span class="anchor-link"></span></a>No <code>Coder[Foo]</code> is available but the compiler can derive one</h4>
<p>For certain type (for example case classes with a public constructor), Scio can derive an inline <code>Coder</code> implementation <strong>at compile time</strong>. Note that <strong>it does not generate source code</strong>.</p>
<pre class="prettyprint"><code class="language-scala mdoc">case class Demo(i: Int, s: String, xs: List[Double])
Coder[Demo]
</code></pre>
<p>sealed class hierarchy are also supported:</p>
<pre class="prettyprint"><code class="language-scala mdoc">sealed trait Top
final case class TA(anInt: Int, aString: String) extends Top
final case class TB(anDouble: Double) extends Top
Coder[Top]
</code></pre>
<h4><a href="#no-coder-foo-is-available-and-the-compiler-can-not-derive-one" name="no-coder-foo-is-available-and-the-compiler-can-not-derive-one" class="anchor"><span class="anchor-link"></span></a>No <code>Coder[Foo]</code> is available and the compiler can not derive one</h4>
<p>Sometimes, no <code>Coder</code> instance can be found, and it&rsquo;s impossible to automatically derive one. In that case, Scio can fallback to a <code>Kryo</code> coder for that type by importing <code>com.spotify.scio.coders.kryo._</code>. Note that <strong>it might negatively impact the performance of your job</strong>.</p>
<p>If the scalac flag <code>-Xmacro-settings:show-coder-fallback=true</code> is set, a warning message will be displayed <strong>at compile time</strong>. This message should help you keep track where the implicit kryo coder are used.</p>
<p>While compiling the following example with <code>-Xmacro-settings:show-coder-fallback=true</code></p>
<pre class="prettyprint"><code class="language-scala mdoc:reset">import com.spotify.scio.coders._
import com.spotify.scio.coders.kryo._
val localeCoder = Coder[java.util.Locale]
</code></pre>
<p>Scalac will output:</p>
<pre><code>Warning: No implicit Coder found for the following type:

  &gt;&gt; java.util.Locale

using Kryo fallback instead.


  Scio will use a fallback Kryo coder instead.

  If a type is not supported, consider implementing your own implicit Coder for this type.
  It is recommended to declare this Coder in your class companion object:

      object Locale {
        import com.spotify.scio.coders.Coder
        import org.apache.beam.sdk.coders.AtomicCoder

        implicit def coderLocale: Coder[Locale] =
          Coder.beam(new AtomicCoder[Locale] {
            def decode(in: InputStream): Locale = ???
            def encode(ts: Locale, out: OutputStream): Unit = ???
          })
      }

  If you do want to use a Kryo coder, be explicit about it:

      implicit def coderLocale: Coder[Locale] = Coder.kryo[Locale]

  Additional info at:
  - https://spotify.github.io/scio/internals/Coders
</code></pre>
<p>In this example, the compiler could not find a proper instance of <code>Coder[Locale]</code>, and suggest you implement one yourself.</p>
<p>Note that this message is not limited to direct invocation of fallback. For example, if you declare a case class that uses <code>Locale</code> internally, the compiler will show the same warning:</p>
<pre class="prettyprint"><code class="language-scala mdoc:reset">import com.spotify.scio.coders.Coder
import com.spotify.scio.coders.kryo._
case class Demo2(i: Int, s: String, xs: List[java.util.Locale])
val demoCoder = Coder[Demo2]
</code></pre>
<p><code>Int</code>, <code>String</code> and <code>List</code> all have predefined <code>Coder</code> instances but <code>Locale</code> does not. The serialization of <code>Locale</code> instances is delegated to Kryo.</p>
<h2><a href="#compiler-flags-and-warnings" name="compiler-flags-and-warnings" class="anchor"><span class="anchor-link"></span></a>Compiler flags and warnings</h2>
<p>When Scio automatically derives a Coder for a given type, it may issue warnings about potential performance issues. For example, the default implementation of <code>Coder[GenericRecord]</code> is very inefficient and Scio will issue a message if it is used:</p>
<pre><code>[info] Using a fallback coder for Avro&#39;s GenericRecord is discouraged as it is VERY inefficient.
[info] It is highly recommended to define a proper Coder[GenericRecord] using:
[info]
[info]   Coder.avroGenericRecordCoder(schema)
</code></pre>
<p>It is also possible to pass a flag to the compiler to issue a message anytime the fallback coder is used:</p>
<pre><code>[info]  Warning: No implicit Coder found for the following type:
[info]
[info]    &gt;&gt; com.google.common.collect.SetMultimap[String,String]
[info]
[info]  using Kryo fallback instead.
</code></pre>
<p>To activate this feature, pass <code>-Xmacro-settings:show-coder-fallback=true</code> to <code>scalac</code> in your build file:</p>
<pre class="prettyprint"><code class="language-scala">scalacOptions += &quot;-Xmacro-settings:show-coder-fallback=true&quot;
</code></pre>
<h2><a href="#how-to-build-a-custom-coder" name="how-to-build-a-custom-coder" class="anchor"><span class="anchor-link"></span></a>How to build a custom Coder</h2>
<p>It is possible for the user to define their own <code>Coder</code> implementation. Scio provides <a href="https://spotify.github.io/scio/api/com/spotify/scio/coders/CoderGrammar.html" title="com.spotify.scio.coders.CoderGrammar"><code>builder functions</code></a> in the <code>Coder</code> object. If you want to create a custom <code>Coder</code>, you should use one of the those three builder:</p>
<ul>
  <li>
  <p><strong><code>Coder.beam</code></strong>: Create a Scio <code>Coder</code> that simply wraps a Beam implementation. For example:</p>
  <pre class="prettyprint"><code class="language-scala mdoc">import com.spotify.scio.coders._
import org.apache.beam.sdk.coders.DoubleCoder
implicit def doubleCoder = Coder.beam(DoubleCoder.of())
</code></pre></li>
  <li>
  <p><strong><code>Coder.transform</code></strong>: Create a Coder for a type <code>B</code> by transforming the Beam implementation for a type <code>A</code>. Usually useful for <code>Coder</code> that depend on another <code>Coder</code>:</p>
  <pre class="prettyprint"><code class="language-scala mdoc">import java.io.{InputStream, OutputStream}
import org.apache.beam.sdk.coders.AtomicCoder
class ListCoder[T](bc: org.apache.beam.sdk.coders.Coder[T]) extends AtomicCoder[List[T]] {
  override def encode(value: List[T], outStream: OutputStream): Unit = ???
  override def decode(inStream: InputStream): List[T] = ???
}
implicit def listCoder[T: Coder]: Coder[List[T]] = Coder.transform(Coder[T])(bc =&gt; Coder.beam(new ListCoder[T](bc)))
</code></pre></li>
  <li>
  <p><strong><code>Coder.xmap</code></strong>: Create a Coder for a type <code>B</code> by reusing a <code>Coder[A]</code>. <code>xmap</code> simply apply the provided function to convert <code>B</code> to <code>A</code> and back. See for example a possible <code>Coder[Char]</code> based on an existing <code>Coder[Byte]</code></p>
  <pre class="prettyprint"><code class="language-scala mdoc">implicit def charCoder: Coder[Char] = Coder.xmap(Coder[Byte])(_.toChar, _.toByte)
</code></pre></li>
</ul>
<h3><a href="#serialization-" name="serialization-" class="anchor"><span class="anchor-link"></span></a>â  Serialization â </h3>
<p>Coder instances <strong>have to</strong> be <code>Serializable</code>. You do not need to extend <code>Serializable</code> explicitly since the <code>Coder</code> trait already does, but you do need to make sure that your implementation is not referencing a non-serializable object in any way.</p>
<p>Note that in test mode (when you use <code>JobTest</code>), Scio will make sure that all the coders used in the job are serializable.</p>
<h3><a href="#testing-custom-coders" name="testing-custom-coders" class="anchor"><span class="anchor-link"></span></a>Testing custom coders</h3>
<p>Scio provides a few assertions specific to coders. See <a href="https://spotify.github.io/scio/api/com/spotify/scio/testing/CoderAssertions$.html" title="com.spotify.scio.testing.CoderAssertions"><code>CoderAssertions</code></a>.</p>
<h2><a href="#null-values-support" name="null-values-support" class="anchor"><span class="anchor-link"></span></a>Null values support</h2>
<p>By default, and for performance reasons, Scio coders will expect the values to serialized to never be <code>null</code>.</p>
<p>This may cause the following exception to be thrown:</p>
<pre><code>org.apache.beam.sdk.Pipeline$PipelineExecutionException: java.lang.RuntimeException:
  Exception while trying to `encode` an instance of scala.Tuple3:
  Can&#39;t encode field _3 value null
</code></pre>
<p>There are 2 ways to fix this issue:</p>
<ol>
  <li><strong>Recommended</strong>: Replace <code>null</code> values by <code>Option</code> in you job code.</li>
  <li><strong>NOT recommended</strong>: pass the following flag when you start the job:
    <p><code>
 --nullableCoders=true
</code></p>
    <p>If you pass this option, Scio will assume that every value are potentially <code>null</code>. This include every single fields in your case classes and each every elements in collections. <strong>It introduces overhead and may slow down your job execution.</strong></p>
  </li>
</ol>
<h2><a href="#upgrading-to-v0-7-0-or-above-migrating-to-static-coder" name="upgrading-to-v0-7-0-or-above-migrating-to-static-coder" class="anchor"><span class="anchor-link"></span></a>Upgrading to <code>v0.7.0</code> or above: Migrating to static coder</h2>
<p>Migrating to Scio <code>0.7.x</code> from an older version is likely to break a few things at compile time in your project. See the complete <a href="../releases/migrations/v0.7.0-Migration-Guide.html">v0.7.0 Migration Guide</a> for more information.</p>
</div>
<div>
<a href="https://github.com/spotify/scio/tree/master/site/src/main/paradox/internals/Coders.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.14.18-23-19528e8-20250827T172948Z*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../internals/index.html" title="Internals" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Internals
</span>
</div>
</a>
<a href="../internals/Kryo.html" title="Kryo" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Kryo
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright (C) 2025 Spotify AB
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://sbt.github.io/sbt-paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/spotify" class="md-footer-social__link fa fa-github"></a><a href="https://twitter.com/spotifyeng" class="md-footer-social__link fa fa-twitter"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
