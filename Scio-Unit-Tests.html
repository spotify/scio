<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Scio - Documentation">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Scio - Documentation">
<link rel="shortcut icon" href="images/favicon.ico">
<title>Testing Â· Scio</title>
<link rel="stylesheet" href="assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="assets/stylesheets/application-palette.22915126.css">
<link rel="stylesheet" href="lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="lib/prettify/prettify.css">
<script src="assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="assets/fonts/font-awesome.css">
<link rel="stylesheet" href="assets/fonts/material-icons.css">
<link rel="stylesheet" href="assets/stylesheets/paradox-material-theme.css">
</head>
<body
data-md-color-primary="white"
data-md-color-accent="indigo"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="index.html" title="Scio" class="md-header-nav__button md-logo">
<img src="images/logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Scio
</span>
<span class="md-header-nav__topic">
Testing
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/spotify/scio"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
spotify/scio
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="index.html" title="Scio" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="images/logo.png" width="24" height="24">
</a>
<a href="index.html" title="Scio">
Scio
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/spotify/scio"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
spotify/scio
</div>
</a>

</div>
<ul>
  <li><a href="Getting-Started.html" class="page">Getting Started</a></li>
  <li><a href="Builtin.html" class="page">Built-in Functionality</a></li>
  <li><a href="Joins.html" class="page">Joins</a></li>
  <li><a href="SideInputs.html" class="page">Side Inputs</a></li>
  <li><a href="io/index.html" class="page">IO</a>
  <ul>
    <li><a href="io/Avro.html" class="page">Avro</a></li>
    <li><a href="io/Binary.html" class="page">Binary</a></li>
    <li><a href="io/BigQuery.html" class="page">BigQuery</a></li>
    <li><a href="io/Bigtable.html" class="page">Bigtable</a></li>
    <li><a href="io/Cassandra.html" class="page">Cassandra</a></li>
    <li><a href="io/Csv.html" class="page">CSV</a></li>
    <li><a href="io/Datastore.html" class="page">Datastore</a></li>
    <li><a href="io/Grpc.html" class="page">GRPC</a></li>
    <li><a href="io/Elasticsearch.html" class="page">Elasticsearch</a></li>
    <li><a href="io/Jdbc.html" class="page">JDBC</a></li>
    <li><a href="io/Json.html" class="page">Json</a></li>
    <li><a href="io/Neo4J.html" class="page">Neo4J</a></li>
    <li><a href="io/Object.html" class="page">Object file</a></li>
    <li><a href="io/Parquet.html" class="page">Parquet</a></li>
    <li><a href="io/Protobuf.html" class="page">Protobuf</a></li>
    <li><a href="io/Pubsub.html" class="page">PubSub</a></li>
    <li><a href="io/ReadFiles.html" class="page">ReadFiles</a></li>
    <li><a href="io/Redis.html" class="page">Redis</a></li>
    <li><a href="io/Spanner.html" class="page">Spanner</a></li>
    <li><a href="io/Tensorflow.html" class="page">Tensorflow</a></li>
    <li><a href="io/Text.html" class="page">Text</a></li>
  </ul></li>
  <li><a href="examples.html" class="page">Examples</a></li>
  <li><a href="Scio-Unit-Tests.html" class="active page">Testing</a></li>
  <li><a href="internals/index.html" class="page">Internals</a>
  <ul>
    <li><a href="internals/Coders.html" class="page">Coder Typeclass</a></li>
    <li><a href="internals/Kryo.html" class="page">Kryo</a></li>
    <li><a href="internals/OverrideTypeProvider.html" class="page">OverrideTypeProvider</a></li>
    <li><a href="internals/ScioIO.html" class="page">ScioIO</a></li>
  </ul></li>
  <li><a href="extras/index.html" class="page">Extras</a>
  <ul>
    <li><a href="extras/Algebird.html" class="page">Algebird</a></li>
    <li><a href="extras/Annoy.html" class="page">Annoy</a></li>
    <li><a href="extras/AsyncDoFn.html" class="page">AsyncDoFn</a></li>
    <li><a href="extras/BigQueryAvro.html" class="page">BigQueryAvro</a></li>
    <li><a href="extras/DistCache.html" class="page">DistCache</a></li>
    <li><a href="extras/Fanout.html" class="page">Fanout</a></li>
    <li><a href="extras/HyperLogLog.html" class="page">HyperLogLog</a></li>
    <li><a href="extras/MutableScalableBloomFilter.html" class="page">MutableScalableBloomFilter</a></li>
    <li><a href="extras/Sorter.html" class="page">Sorter</a></li>
    <li><a href="extras/Sort-Merge-Bucket.html" class="page">Sort Merge Bucket</a></li>
    <li><a href="extras/Sparkey.html" class="page">Sparkey</a></li>
    <li><a href="extras/Scio-REPL.html" class="page">REPL</a></li>
    <li><a href="extras/Transforms.html" class="page">Transforms</a></li>
    <li><a href="extras/Voyager.html" class="page">Voyager</a></li>
  </ul></li>
  <li><a href="dev/index.html" class="page">Development</a>
  <ul>
    <li><a href="dev/build.html" class="page">Build</a></li>
    <li><a href="dev/Style-Guide.html" class="page">Style Guide</a></li>
    <li><a href="dev/How-to-Release.html" class="page">How to Release</a></li>
    <li><a href="dev/Design-Philosophy.html" class="page">Design Philosophy</a></li>
  </ul></li>
  <li><a href="scaladoc.html" class="page">Scaladoc</a></li>
  <li><a href="Scio,-Scalding-and-Spark.html" class="page">Scio, Spark and Scalding</a></li>
  <li><a href="Runners.html" class="page">Runners</a></li>
  <li><a href="Scio-data-guideline.html" class="page">Data Guidelines</a></li>
  <li><a href="releases/index.html" class="page">Releases</a>
  <ul>
    <li><a href="releases/Apache-Beam.html" class="page">Apache Beam Compatibility</a></li>
    <li><a href="releases/migrations/index.html" class="page">Migration Guides</a></li>
    <li><a href="releases/breaking-changes.html" class="page">Breaking Changelog</a></li>
    <li><a href="releases/v0.12.0.html" class="page">v0.12.0 Release Blog</a></li>
  </ul></li>
  <li><a href="FAQ.html" class="page">FAQ</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="Scio-Unit-Tests.html#testing" class="header">Testing</a>
  <ul>
    <li><a href="Scio-Unit-Tests.html#test-entire-pipeline" class="header">Test entire pipeline</a></li>
    <li><a href="Scio-Unit-Tests.html#test-for-pipeline-with-sideinput" class="header">Test for pipeline with sideinput</a></li>
    <li><a href="Scio-Unit-Tests.html#test-for-pipeline-with-sideoutput" class="header">Test for pipeline with sideoutput</a></li>
    <li><a href="Scio-Unit-Tests.html#test-partial-pipeline" class="header">Test partial pipeline</a></li>
    <li><a href="Scio-Unit-Tests.html#test-for-pipeline-with-windowing" class="header">Test for pipeline with windowing</a></li>
    <li><a href="Scio-Unit-Tests.html#test-with-transform-overrides" class="header">Test with transform overrides</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.14.12-7-93a20de-20250226T204334Z*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="Scio-Unit-Tests.html#testing" class="header">Testing</a>
  <ul>
    <li><a href="Scio-Unit-Tests.html#test-entire-pipeline" class="header">Test entire pipeline</a></li>
    <li><a href="Scio-Unit-Tests.html#test-for-pipeline-with-sideinput" class="header">Test for pipeline with sideinput</a></li>
    <li><a href="Scio-Unit-Tests.html#test-for-pipeline-with-sideoutput" class="header">Test for pipeline with sideoutput</a></li>
    <li><a href="Scio-Unit-Tests.html#test-partial-pipeline" class="header">Test partial pipeline</a></li>
    <li><a href="Scio-Unit-Tests.html#test-for-pipeline-with-windowing" class="header">Test for pipeline with windowing</a></li>
    <li><a href="Scio-Unit-Tests.html#test-with-transform-overrides" class="header">Test with transform overrides</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#testing" name="testing" class="anchor"><span class="anchor-link"></span></a>Testing</h1>
<p>To write Scio unit tests you will need to add the following dependency to your build.sbt</p>
<pre class="prettyprint"><code class="language-sbt">libraryDependencies ++= Seq(
  // .......
  &quot;com.spotify&quot; %% &quot;scio-test-core&quot; % scioVersion % Test,
  // .......
)
</code></pre>
<p>To run the test, you can run the following commands. You can skip the first two lines if you already ran them and are still in the sbt shell.</p>
<pre class="prettyprint"><code class="language-cmd">$ sbt
&gt; project scio-examples
&gt; test
</code></pre>
<p>Click on this <a href="https://www.scala-sbt.org/1.x/docs/Testing.html">link</a> for more Scala testing tasks.</p>
<h3><a href="#test-entire-pipeline" name="test-entire-pipeline" class="anchor"><span class="anchor-link"></span></a>Test entire pipeline</h3>
<p>We will use the WordCountTest to explain how Scio tests work. <a href="https://spotify.github.io/scio/examples/WordCount.scala.html">WordCount</a> is the pipeline under test. Full example code for WordCountTest and other test examples can be found <a href="https://github.com/spotify/scio/tree/master/scio-examples/src/test">here</a>.</p>
<p>Letâs walk through the details of the test: The test class should extend the <code>PipelineSpec</code> which is a trait for unit testing pipelines.</p>
<p>The inData variable holds the input data for your test and the expected variable contains the expected results after your pipeline processes the inData. The WordCount pipeline counts the occurrence of each word, the given the input data , we should expect a count of a=3, b=3, c=1 etc</p>
<pre class="prettyprint"><code class="language-scala mdoc"> val inData = Seq(&quot;a b c d e&quot;, &quot;a b a b&quot;, &quot;&quot;)
 val expected = Seq(&quot;a: 3&quot;, &quot;b: 3&quot;, &quot;c: 1&quot;, &quot;d: 1&quot;, &quot;e: 1&quot;)
</code></pre>
<p>Using <code>JobTest</code>, you can test the entire pipeline. Specify the type of the class under test, in this case it is com.spotify.scio.examples.WordCount.type . The <code>args</code> function takes the list of command line arguments passed to the main function of WordCount. The WordCountâs main function expects input and output arguments passed to it.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/WordCountTest.scala#L28-L34" target="_blank" title="Go to snippet source">source</a><code class="language-scala">&quot;WordCount&quot; should &quot;work&quot; in {
  JobTest[com.spotify.scio.examples.WordCount.type]
    .args(&quot;--input=in.txt&quot;, &quot;--output=out.txt&quot;)
    .input(TextIO(&quot;in.txt&quot;), inData)
    .output(TextIO(&quot;out.txt&quot;))(coll =&gt; coll should containInAnyOrder(expected))
    .run()
}</code></pre>
<p>The <code>input</code> function injects your input test data. Note that the <code>TestIO[T]</code> should match the input source used in the pipeline e.g. TextIO for sc.textFile, AvroIO for sc.avro. The TextIO id (âin.txtâ) should match the one specified in the args.</p>
<p>The output function evaluates the output of the pipeline using the provided assertion from the <code>SCollectionMatchers</code>. More info on <code>SCollectionMatchers</code> can be found <a href="https://spotify.github.io/scio/api/com/spotify/scio/testing/SCollectionMatchers$.html" title="com.spotify.scio.testing.SCollectionMatchers"><code>here</code></a>. In this example, we are asserting that the output of the pipeline should contain an <code>SCollection</code> with elements that in the expected variable in any order. Also, note that the <code>TestIO[T]</code> should match the output used in the pipeline e.g. TextIO for sc.saveAsTextFile</p>
<p>The run function will run the pipeline.</p>
<h3><a href="#test-for-pipeline-with-sideinput" name="test-for-pipeline-with-sideinput" class="anchor"><span class="anchor-link"></span></a>Test for pipeline with sideinput</h3>
<p>We will use the <a href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/cookbook/JoinExamplesTest.scala#L73">SideInputJoinExamples</a> test in JoinExamplesTest to illustrate how to write a test for pipelines with sideinputs. The <a href="https://spotify.github.io/scio/examples/JoinExamples.scala.html">SideInputJoinExamples</a> pipeline has two input sources, one for eventsInfo and the other for countryInfo. CountryInfo is used as a sideinput to join with eventInfo.</p>
<p>Since we have two input sources, we have to specify both in the <code>JobTest</code>. Note that the injected data type should match one expected by the sink.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/cookbook/JoinExamplesTest.scala#L79-L86" target="_blank" title="Go to snippet source">source</a><code class="language-scala">&quot;SideInputJoinExamples&quot; should &quot;work&quot; in {
  JobTest[com.spotify.scio.examples.cookbook.SideInputJoinExamples.type]
    .args(&quot;--output=out.txt&quot;)
    .input(BigQueryIO(ExampleData.EVENT_TABLE), eventData)
    .input(BigQueryIO(ExampleData.COUNTRY_TABLE), countryData)
    .output(TextIO(&quot;out.txt&quot;))(coll =&gt; coll should containInAnyOrder(expected))
    .run()
}</code></pre>
<h3><a href="#test-for-pipeline-with-sideoutput" name="test-for-pipeline-with-sideoutput" class="anchor"><span class="anchor-link"></span></a>Test for pipeline with sideoutput</h3>
<p><a href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/extra/SideInOutExampleTest.scala">SideInOutExampleTest</a> shows an example of how to test pipelines with sideoutputs. Each sideoutput is evaluated using the output function. The ids for <code>TextIO</code> e.g. âout1.txtâ should match the ones specified in the args.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/extra/SideInOutExampleTest.scala#L25-L46" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val inData: Seq[String] = Seq(&quot;The quick brown fox jumps over the lazy dog.&quot;)

&quot;SideInOutExample&quot; should &quot;work&quot; in {
  JobTest[SideInOutExample.type]
    .args(
      &quot;--input=in.txt&quot;,
      &quot;--stopWords=stop.txt&quot;,
      &quot;--output1=out1.txt&quot;,
      &quot;--output2=out2.txt&quot;,
      &quot;--output3=out3.txt&quot;,
      &quot;--output4=out4.txt&quot;
    )
    .input(TextIO(&quot;in.txt&quot;), inData)
    .input(TextIO(&quot;stop.txt&quot;), Seq(&quot;the&quot;))
    .output(TextIO(&quot;out1.txt&quot;))(coll =&gt; coll should containInAnyOrder(Seq.empty[String]))
    .output(TextIO(&quot;out2.txt&quot;))(coll =&gt; coll should containInAnyOrder(Seq.empty[String]))
    .output(TextIO(&quot;out3.txt&quot;))(coll =&gt; coll should containInAnyOrder(Seq(&quot;dog: 1&quot;, &quot;fox: 1&quot;)))
    .output(TextIO(&quot;out4.txt&quot;)) {
      _ should containInAnyOrder(Seq(&quot;brown: 1&quot;, &quot;jumps: 1&quot;, &quot;lazy: 1&quot;, &quot;over: 1&quot;, &quot;quick: 1&quot;))
    }
    .run()
}</code></pre>
<h3><a href="#test-partial-pipeline" name="test-partial-pipeline" class="anchor"><span class="anchor-link"></span></a>Test partial pipeline</h3>
<p>To test a section of a pipeline, use <code>runWithContext</code>. The TriggerExample.extractFlowInfo test in <a href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/cookbook/TriggerExampleTest.scala">TriggerExampleTest</a> tests only the extractFlowInfo part of the pipeline.</p>
<p>The data variable hold the test data and <code>sc.parallelize</code> will transform the input Iterable to an <code>SCollection</code> of strings. TriggerExample.extractFlowInfo will be executed using the <code>ScioContext</code> and you can then specify assertions against the result of the pipeline.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/cookbook/TriggerExampleTest.scala#L25-L37" target="_blank" title="Go to snippet source">source</a><code class="language-scala">&quot;TriggerExample.extractFlowInfo&quot; should &quot;work&quot; in {
  val data = Seq(
    &quot;01/01/2010 00:00:00,1108302,94,E,ML,36,100,29,0.0065,66,9,1,0.001,74.8,1,9,3,0.0028,71,1,9,&quot;
      + &quot;12,0.0099,67.4,1,9,13,0.0121,99.0,1,,,,,0,,,,,0,,,,,0,,,,,0&quot;,
    &quot;01/01/2010 00:00:00,&quot;
      + &quot;1100333,5,N,FR,9,0,39,,,9,,,,0,,,,,0,,,,,0,,,,,0,,,,,0,,,,,0,,,,,0,,,,&quot;
  )
  runWithContext { sc =&gt;
    val r = TriggerExample.extractFlowInfo(sc.parallelize(data))
    r should haveSize(1)
    r should containSingleValue((&quot;94&quot;, 29))
  }
}</code></pre>
<p>When your pipeline section contains input and/or output, you can also create an anonymous <code>JobTest</code> to inject the test data.</p>
<p>If we have the following pipeline section:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L54-L58" target="_blank" title="Go to snippet source">source</a><code class="language-scala">def pipeline(sc: ScioContext, input: String, output: String): Unit = {
  sc.textFile(input)
    .map(_ + &quot;X&quot;)
    .saveAsTextFile(output)
}</code></pre>
<p>It can be tested with:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L349-L352" target="_blank" title="Go to snippet source">source</a><code class="language-scala">JobTest(pipeline(_, &quot;in.txt&quot;, &quot;out.txt&quot;))
  .input(TextIO(&quot;in.txt&quot;), Seq(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;))
  .output(TextIO(&quot;out.txt&quot;))(_ should containInAnyOrder(Seq(&quot;aX&quot;, &quot;bX&quot;, &quot;cX&quot;)))
  .run()</code></pre>
<h3><a href="#test-for-pipeline-with-windowing" name="test-for-pipeline-with-windowing" class="anchor"><span class="anchor-link"></span></a>Test for pipeline with windowing</h3>
<p>We will use the LeaderBoardTest to explain how to test Windowing in Scio. The full example code is found <a href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/complete/game/LeaderBoardTest.scala">here</a>. LeaderBoardTest also extends <code>PipelineSpec</code>. The function under test is the <a href="https://github.com/spotify/scio/tree/master/scio-examples/src/main/scala/com/spotify/scio/examples/complete/game/LeaderBoard.scala#L131">LeaderBoard.calculateTeamScores</a>. This function calculates teams scores within a fixed window with the following the window options:</p>
<ul>
  <li>Calculate the scores every time the window ends</li>
  <li>Calculate an early/&ldquo;speculative&rdquo; result from partial data, 5 minutes after the first element in our window is processed (withEarlyFiring)</li>
  <li>Accept late entries (and recalculates based on them) only if they arrive within the allowedLateness duration.</li>
</ul>
<p>In this test, we are testing calculateTeamScores for when all of the elements arrive on time, i.e. before the watermark.</p>
<p>First, we have to create an input stream representing an unbounded <code>SCollection</code> of type GameActionInfo using the <code>testStreamOf</code>. Each element is assigned a timestamp representing when each event occurred. In the code snippet above, we start at epoch equal zero, by setting watermark to 0 in the advanceWatermarkTo.</p>
<p>We add GameActionInfo elements with varying timestamps, and we advanced the watermark to 3 minutes. At this point, all elements are on time because they came before the watermark advances to 3 minutes.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/complete/game/LeaderBoardTest.scala#L48-L57" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val stream = testStreamOf[GameActionInfo]
  // Start at the epoch
  .advanceWatermarkTo(baseTime)
  // add some elements ahead of the watermark
  .addElements(
    event(blueOne, 3, Duration.standardSeconds(3)),
    event(blueOne, 2, Duration.standardMinutes(1)),
    event(redTwo, 3, Duration.standardSeconds(22)),
    event(blueTwo, 5, Duration.standardSeconds(3))
  )</code></pre>
<p>We then more GameActionInfo elements and advance the watermark to infinity by calling the advanceWatermarkToInfinity. Similarly, these elements are also on time because the watermark is infinity.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/complete/game/LeaderBoardTest.scala#L60-L67" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// The watermark advances slightly, but not past the end of the window
.advanceWatermarkTo(baseTime.plus(Duration.standardMinutes(3)))
.addElements(
  event(redOne, 1, Duration.standardMinutes(4)),
  event(blueOne, 2, Duration.standardSeconds(270))
)
// The window should close and emit an ON_TIME pane
.advanceWatermarkToInfinity</code></pre>
<p>To run the test, we use the <code>runWithContext</code>, this will run calculateTeamScores using the ScioContext. In calculateTeamScores, we pass the <code>SCollection</code> we created above using <code>testStreamOf</code>. The <code>IntervalWindow</code> specifies the window for which we want to assert the <code>SCollection</code> of elements created by calculateTeamScores. We want to assert that elements with initial window of 0 to 20 minutes were on time. Next we assert, using <code>inOnTimePane</code> that the <code>SCollection</code> elements are equal to the expected sums.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-examples/src/test/scala/com/spotify/scio/examples/complete/game/LeaderBoardTest.scala#L71-L79" target="_blank" title="Go to snippet source">source</a><code class="language-scala">runWithContext { sc =&gt;
  val teamScores =
    LeaderBoard.calculateTeamScores(sc.testStream(stream), teamWindowDuration, allowedLateness)

  val window = new IntervalWindow(baseTime, teamWindowDuration)
  teamScores should inOnTimePane(window) {
    containInAnyOrder(Seq((blueOne.team, 12), (redOne.team, 4)))
  }
}</code></pre>
<p>Scio provides more <code>SCollection</code> assertions such as <code>inWindow</code>, <code>inCombinedNonLatePanes</code>, <code>inFinalPane</code>, and <code>inOnlyPane</code>. You can find the full list <a href="https://spotify.github.io/scio/api/com/spotify/scio/testing/SCollectionMatchers.html" title="com.spotify.scio.testing.SCollectionMatchers"><code>here</code></a>. More information on testing unbounded pipelines can be found <a href="https://beam.apache.org/blog/2016/10/20/test-stream.html">here</a>.</p>
<h3><a href="#test-with-transform-overrides" name="test-with-transform-overrides" class="anchor"><span class="anchor-link"></span></a>Test with transform overrides</h3>
<p>Scio provides a method to replace arbitrary <em>named</em> <code>PTransform</code>s in a test context; this is primarily useful for mocking requests to external services.</p>
<p>In this example, the <code>GuavaLookupDoFn</code> stands in for a transform that contacts an external service. A <code>ParDo</code> <code>PTransform</code> is created from the <code>DoFn</code> (<code>ParDo.of</code>), then applied to the pipeline (<code>applyTransform</code>) with a unique name (<code>myTransform</code>).</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L128-L132" target="_blank" title="Go to snippet source">source</a><code class="language-scala">sc.textFile(args(&quot;input&quot;))
  .map(_.toInt)
  .applyTransform(&quot;myTransform&quot;, ParDo.of(new GuavaLookupDoFn))
  .map((i: KV[Int, BaseAsyncLookupDoFn.Try[String]]) =&gt; i.getValue.get())
  .saveAsTextFile(args(&quot;output&quot;))</code></pre>
<p>In a <code>JobTest</code>, a <code>PTransformOverride</code> can be passed to the <code>transformOverride</code> method to replace transforms in the original pipeline. Scio provides convenience methods for constructing <code>PTransformOverride</code>s in the <code>com.spotify.scio.testing.TransformOverride</code> object. Continuing the example above, <code>TransformOverride.ofAsyncLookup</code> can be used to map static mock data into the expected output format for the transform, here <code>KV[Int, BaseAsyncLookupDoFn.Try[String]]</code>.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L1125-L1130" target="_blank" title="Go to snippet source">source</a><code class="language-scala">.transformOverride(
  TransformOverride.ofAsyncLookup[Int, String](
    &quot;myTransform&quot;,
    Map(1 -&gt; &quot;10&quot;, 2 -&gt; &quot;20&quot;, 3 -&gt; &quot;30&quot;)
  )
)</code></pre>
<p>It is also possible to provide a function rather than a static map:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L1142-L1145" target="_blank" title="Go to snippet source">source</a><code class="language-scala">TransformOverride.ofAsyncLookup[Int, String](
  &quot;myTransform&quot;,
  (i: Int) =&gt; s&quot;${i * 10}&quot;
)</code></pre>
<p>In a scenario when the PTransform&rsquo;s output is generating more elements than input, e.g. there is a flatmap inside the transform:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L145-L150" target="_blank" title="Go to snippet source">source</a><code class="language-scala">.withName(&quot;myTransform&quot;)
.transform { c: SCollection[Int] =&gt;
  c.applyTransform(ParDo.of(new GuavaLookupDoFn))
    .flatMap(_.getValue.get())
    .map(_.toString)
}</code></pre>
<p>The transform can be mocked by one of the flavours of <code>ofIter</code> method to map each element to an Iterable[U]:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L924-L927" target="_blank" title="Go to snippet source">source</a><code class="language-scala">TransformOverride.ofIter[Int, String](
  &quot;myTransform&quot;,
  Map(1 -&gt; Seq(&quot;10&quot;), 2 -&gt; Seq(&quot;20&quot;, &quot;21&quot;), 3 -&gt; Seq())
)</code></pre>
<p>or similarly provide a function rather than a static map:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L940-L944" target="_blank" title="Go to snippet source">source</a><code class="language-scala">TransformOverride.ofIter[Int, String](
  &quot;myTransform&quot;,
  // map fn equal to: Map(1 -&gt; Seq(), 2 -&gt; Seq(&quot;1&quot;), 3 -&gt; Seq(&quot;1&quot;, &quot;2&quot;)}
  (i: Int) =&gt; { (1 until i).map(String.valueOf(_)) }
)</code></pre>
<p><code>TransformOverride.of</code> overrides transforms of type <code>PTransform[PCollection[T], PCollection[U]]</code> as in the case of <code>BaseAsyncDoFn</code> subclasses. <code>TransformOverride.ofKV</code> overrides transforms of type <code>PTransform[PCollection[T], PCollection[KV[T, U]]]</code>.</p>
<p>Sources can also be overridden with <code>TransformOverride.ofSource</code>. For example, this source:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L86-L87" target="_blank" title="Go to snippet source">source</a><code class="language-scala">sc.withName(&quot;ReadInput&quot;)
  .textFile(args(&quot;input&quot;))</code></pre>
<p>Can be overridden with static mock data:</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/JobTestTest.scala#L900" target="_blank" title="Go to snippet source">source</a><code class="language-scala">TransformOverride.ofSource[String](&quot;ReadInput&quot;, List(&quot;10&quot;, &quot;11&quot;, &quot;12&quot;))</code></pre>
<p>It is alo possible to override a named <code>PTransform</code> during partial pipeline testing with <code>runWithOverrides</code>.</p>
<pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/spotify/scio/tree/master/scio-test/core/src/test/scala/com/spotify/scio/testing/PipelineTestUtilsTest.scala#L73-L85" target="_blank" title="Go to snippet source">source</a><code class="language-scala">runWithOverrides(
  TransformOverride.of(&quot;multiply&quot;, (v: Int) =&gt; v * v),
  TransformOverride.ofIter(&quot;append&quot;, (v: Int) =&gt; Seq(v + &quot;c&quot;, v + &quot;d&quot;))
) { sc =&gt;
  val result = sc
    .parallelize(Seq(1, 2, 3))
    .withName(&quot;multiply&quot;)
    .map(_ * 2)
    .withName(&quot;append&quot;)
    .flatMap(v =&gt; Seq(v + &quot;a&quot;, v + &quot;b&quot;))

  result should containInAnyOrder(Seq(&quot;1c&quot;, &quot;1d&quot;, &quot;4c&quot;, &quot;4d&quot;, &quot;9c&quot;, &quot;9d&quot;))
}</code></pre>
<p>Due to type erasure it is possible to provide the incorrect types for the transform and the error will not be caught until runtime.</p>
<p>If you&rsquo;ve specified the incorrect input type, scio will attempt to detect the error and throw an <code>IllegalArgumentException</code>, which will be wrapped in a <code>PipelineExecutionException</code> at runtime:</p>
<pre><code>org.apache.beam.sdk.Pipeline$PipelineExecutionException:
  java.lang.IllegalArgumentException:
    Input for override transform myTransform does not match pipeline transform. Expected: class java.lang.Integer Found: class java.lang.String
</code></pre>
<p>If you&rsquo;ve specified the incorrect output type, there is little scio can do to detect the error. Typically, a coder will throw a <code>ClassCastException</code> whose message will contain the correct type:</p>
<pre><code>org.apache.beam.sdk.Pipeline$PipelineExecutionException:
  java.lang.ClassCastException:
    java.lang.String cannot be cast to java.lang.Integer
</code></pre>
</div>
<div>
<a href="https://github.com/spotify/scio/tree/master/site/src/main/paradox/Scio-Unit-Tests.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.14.12-7-93a20de-20250226T204334Z*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="examples.html" title="Examples" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Examples
</span>
</div>
</a>
<a href="internals/index.html" title="Internals" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Internals
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright (C) 2025 Spotify AB
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://sbt.github.io/sbt-paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/spotify" class="md-footer-social__link fa fa-github"></a><a href="https://twitter.com/spotifyeng" class="md-footer-social__link fa fa-twitter"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="assets/javascripts/application.583bbe55.js"></script>
<script src="assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"."}})</script>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
