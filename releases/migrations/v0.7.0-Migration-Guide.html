<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Scio - Documentation">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Scio - Documentation">
<link rel="shortcut icon" href="../../images/favicon.ico">
<title>Scio v0.7.0 Â· Scio</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
data-md-color-primary="white"
data-md-color-accent="indigo"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="Scio" class="md-header-nav__button md-logo">
<img src="../../images/logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Scio
</span>
<span class="md-header-nav__topic">
Scio v0.7.0
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/spotify/scio"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
spotify/scio
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../index.html" title="Scio" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../../images/logo.png" width="24" height="24">
</a>
<a href="../../index.html" title="Scio">
Scio
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/spotify/scio"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
spotify/scio
</div>
</a>

</div>
<ul>
  <li><a href="../../Getting-Started.html" class="page">Getting Started</a></li>
  <li><a href="../../Builtin.html" class="page">Built-in Functionality</a></li>
  <li><a href="../../Joins.html" class="page">Joins</a></li>
  <li><a href="../../SideInputs.html" class="page">Side Inputs</a></li>
  <li><a href="../../io/index.html" class="page">IO</a>
  <ul>
    <li><a href="../../io/Avro.html" class="page">Avro</a></li>
    <li><a href="../../io/Binary.html" class="page">Binary</a></li>
    <li><a href="../../io/BigQuery.html" class="page">BigQuery</a></li>
    <li><a href="../../io/Bigtable.html" class="page">Bigtable</a></li>
    <li><a href="../../io/Cassandra.html" class="page">Cassandra</a></li>
    <li><a href="../../io/Csv.html" class="page">CSV</a></li>
    <li><a href="../../io/Datastore.html" class="page">Datastore</a></li>
    <li><a href="../../io/Grpc.html" class="page">GRPC</a></li>
    <li><a href="../../io/Elasticsearch.html" class="page">Elasticsearch</a></li>
    <li><a href="../../io/Jdbc.html" class="page">JDBC</a></li>
    <li><a href="../../io/Json.html" class="page">Json</a></li>
    <li><a href="../../io/Neo4J.html" class="page">Neo4J</a></li>
    <li><a href="../../io/Object.html" class="page">Object file</a></li>
    <li><a href="../../io/Parquet.html" class="page">Parquet</a></li>
    <li><a href="../../io/Protobuf.html" class="page">Protobuf</a></li>
    <li><a href="../../io/Pubsub.html" class="page">PubSub</a></li>
    <li><a href="../../io/ReadFiles.html" class="page">ReadFiles</a></li>
    <li><a href="../../io/Redis.html" class="page">Redis</a></li>
    <li><a href="../../io/Spanner.html" class="page">Spanner</a></li>
    <li><a href="../../io/Tensorflow.html" class="page">Tensorflow</a></li>
    <li><a href="../../io/Text.html" class="page">Text</a></li>
  </ul></li>
  <li><a href="../../examples.html" class="page">Examples</a></li>
  <li><a href="../../Scio-Unit-Tests.html" class="page">Testing</a></li>
  <li><a href="../../internals/index.html" class="page">Internals</a>
  <ul>
    <li><a href="../../internals/Coders.html" class="page">Coder Typeclass</a></li>
    <li><a href="../../internals/Kryo.html" class="page">Kryo</a></li>
    <li><a href="../../internals/OverrideTypeProvider.html" class="page">OverrideTypeProvider</a></li>
    <li><a href="../../internals/ScioIO.html" class="page">ScioIO</a></li>
  </ul></li>
  <li><a href="../../extras/index.html" class="page">Extras</a>
  <ul>
    <li><a href="../../extras/Algebird.html" class="page">Algebird</a></li>
    <li><a href="../../extras/Annoy.html" class="page">Annoy</a></li>
    <li><a href="../../extras/AsyncDoFn.html" class="page">AsyncDoFn</a></li>
    <li><a href="../../extras/BigQueryAvro.html" class="page">BigQueryAvro</a></li>
    <li><a href="../../extras/DistCache.html" class="page">DistCache</a></li>
    <li><a href="../../extras/Fanout.html" class="page">Fanout</a></li>
    <li><a href="../../extras/HyperLogLog.html" class="page">HyperLogLog</a></li>
    <li><a href="../../extras/MutableScalableBloomFilter.html" class="page">MutableScalableBloomFilter</a></li>
    <li><a href="../../extras/Sorter.html" class="page">Sorter</a></li>
    <li><a href="../../extras/Sort-Merge-Bucket.html" class="page">Sort Merge Bucket</a></li>
    <li><a href="../../extras/Sparkey.html" class="page">Sparkey</a></li>
    <li><a href="../../extras/Scio-REPL.html" class="page">REPL</a></li>
    <li><a href="../../extras/Transforms.html" class="page">Transforms</a></li>
    <li><a href="../../extras/Voyager.html" class="page">Voyager</a></li>
  </ul></li>
  <li><a href="../../dev/index.html" class="page">Development</a>
  <ul>
    <li><a href="../../dev/build.html" class="page">Build</a></li>
    <li><a href="../../dev/Style-Guide.html" class="page">Style Guide</a></li>
    <li><a href="../../dev/How-to-Release.html" class="page">How to Release</a></li>
    <li><a href="../../dev/Design-Philosophy.html" class="page">Design Philosophy</a></li>
  </ul></li>
  <li><a href="../../scaladoc.html" class="page">Scaladoc</a></li>
  <li><a href="../../Scio,-Scalding-and-Spark.html" class="page">Scio, Spark and Scalding</a></li>
  <li><a href="../../Runners.html" class="page">Runners</a></li>
  <li><a href="../../Scio-data-guideline.html" class="page">Data Guidelines</a></li>
  <li><a href="../../releases/index.html" class="page">Releases</a>
  <ul>
    <li><a href="../../releases/Apache-Beam.html" class="page">Apache Beam Compatibility</a></li>
    <li><a href="../../releases/migrations/index.html" class="page">Migration Guides</a></li>
    <li><a href="../../releases/breaking-changes.html" class="page">Breaking Changelog</a></li>
    <li><a href="../../releases/v0.12.0.html" class="page">v0.12.0 Release Blog</a></li>
  </ul></li>
  <li><a href="../../FAQ.html" class="page">FAQ</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../releases/migrations/v0.7.0-Migration-Guide.html#scio-v0-7-0" class="header">Scio v0.7.0</a>
  <ul>
    <li><a href="../../releases/migrations/v0.7.0-Migration-Guide.html#whats-new-" class="header">What&rsquo;s new ?</a></li>
    <li><a href="../../releases/migrations/v0.7.0-Migration-Guide.html#automated-migration" class="header">Automated migration</a></li>
    <li><a href="../../releases/migrations/v0.7.0-Migration-Guide.html#migration-guide" class="header">Migration guide</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.14.7-20-88d07bb-20240916T134149Z*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../releases/migrations/v0.7.0-Migration-Guide.html#scio-v0-7-0" class="header">Scio v0.7.0</a>
  <ul>
    <li><a href="../../releases/migrations/v0.7.0-Migration-Guide.html#whats-new-" class="header">What&rsquo;s new ?</a></li>
    <li><a href="../../releases/migrations/v0.7.0-Migration-Guide.html#automated-migration" class="header">Automated migration</a></li>
    <li><a href="../../releases/migrations/v0.7.0-Migration-Guide.html#migration-guide" class="header">Migration guide</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#scio-v0-7-0" name="scio-v0-7-0" class="anchor"><span class="anchor-link"></span></a>Scio v0.7.0</h1>
<p>Scio <code>0.7.0</code> comes with major improvements over previous versions. The overall goal is to make Scio safer, faster, more consistent and easier to extend by leveraging Scala&rsquo;s type system more and refactoring its internals.</p>
<p>The new milestone has been profiled more than ever and will improve the performances of your pipeline. In some cases, the improvement can be <em>very</em> significant.</p>
<p>Scio <code>0.7.0</code> also includes, like every release, a number of bugfixes.</p>
<h2><a href="#whats-new-" name="whats-new-" class="anchor"><span class="anchor-link"></span></a>What&rsquo;s new ?</h2>
<h3><a href="#new-ios-api" name="new-ios-api" class="anchor"><span class="anchor-link"></span></a>New IOs api</h3>
<p>In this version, we&rsquo;ve refactored the implementation of IOs. Scio now provides a new class <code>ScioIO</code> that you can extend to support new types of IOs. <code>ScioContext</code> now has a new method called <code>read</code> and <code>SCollection</code> now has a new method <code>write</code>. Both take an instance of a class extending <code>ScioIO</code> as a parameter and may read from any source, or write to any target.</p>
<p>All existing IOs (GCS, BigQuery, BigTable, etc.) have been rewritten to use the new IO API.</p>
<p><strong>Read more: <a href="../../internals/ScioIO.html">ScioIO</a></strong></p>
<h3><a href="#new-coders" name="new-coders" class="anchor"><span class="anchor-link"></span></a>New &ldquo;static&rdquo; coders</h3>
<p>Scio <code>0.7.0</code> also ship with a new <code>Coder</code> implementation that statically resolve the correct <code>Coder</code> for a given type <strong>at compile time</strong>. In previous versions, Scio would infer the correct coder implementation at runtime, which could lead to poor performances and occasionally, exceptions at runtime.</p>
<p><strong>Read more: <a href="../../internals/Coders.html">Coders</a>.</strong></p>
<h3><a href="#performances-improvements-benchmarks" name="performances-improvements-benchmarks" class="anchor"><span class="anchor-link"></span></a>Performances improvements &amp; benchmarks</h3>
<p>Thanks to the new static coders implementation, and because of the time we spend on profiling, Scio <code>0.7.0</code> should overall be more efficient than previous versions.</p>
<h2><a href="#automated-migration" name="automated-migration" class="anchor"><span class="anchor-link"></span></a>Automated migration</h2>
<p>Scio <code>0.7</code> comes with a set of <a href="https://scalacenter.github.io/scalafix/">scalafix</a> rules that will do most of the heavy lifting automatically. Before you go through any manual step, we recommend you start by applying those rules.</p>
<p>Start by adding the scalafix sbt plugin to your <code>project/plugins.sbt</code> file</p>
<pre class="prettyprint"><code class="language-sbt">addSbtPlugin(&quot;ch.epfl.scala&quot; % &quot;sbt-scalafix&quot; % &quot;0.9.0&quot;)
</code></pre>
<p>launch sbt and run <code>scalafixEnable</code></p>
<pre><code>&gt; scalafixEnable
[info] Set current project to my-amazing-scio-pipeline (in build file:/Users/julient/Documents/my-amazing-scio-pipeline/)
</code></pre>
<h3><a href="#prepare-your-tests" name="prepare-your-tests" class="anchor"><span class="anchor-link"></span></a>Prepare your tests</h3><div class="callout warning "><div class="callout-title">Warning</div>
<p>RUN THIS BEFORE UPGRADING SCIO</p></div>
<p>You&rsquo;ll need to prepare your tests code for migration. For this to run properly, you code needs to compile.</p>
<p>Run the following command in the sbt shell:</p>
<pre><code>&gt; test:scalafix https://raw.githubusercontent.com/spotify/scio/main/scalafix/rules/src/main/scala/fix/v0_7_0/FixAvroIO.scala
[info] Running scalafix on 78 Scala sources
[success] Total time: 7 s, completed Oct 17, 2018 12:49:31 PM
</code></pre>
<p>Once <code>FixAvroIO</code> has been applied, you can go ahead and upgrade Scio to <code>0.7.x</code> in your build file. After you have set Scio&rsquo;s version in your <code>build.sbt</code>, make sure to either restart or reload sbt.</p>
<p>You can now run the automated migration rules. At the moment, we support 4 rules:</p>
<table>
  <thead>
    <tr>
      <th>Name </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>AddMissingImports </td>
      <td>Add the required imports to access sources / sinks on <code>ScioContext</code> and <code>SCollection</code> </td>
    </tr>
    <tr>
      <td>RewriteSysProp </td>
      <td>Replace <code>sys.call(...)</code> by the new syntax </td>
    </tr>
    <tr>
      <td>FixAvroIO </td>
      <td>Fix uses of <code>AvroIO</code> in tests </td>
    </tr>
    <tr>
      <td>BQClientRefactoring </td>
      <td>Automatically migrate from <code>BigQueryClient</code> to the new <code>BigQuery</code> client </td>
    </tr>
  </tbody>
</table>
<p>You can see all the rules <a href="https://github.com/spotify/scio/tree/master/scalafix/rules/src/main/scala/fix">here</a>.</p>
<p>In your sbt shell, you can now apply the 3 other rules:</p>
<pre><code>&gt; scalafix https://raw.githubusercontent.com/spotify/scio/main/scalafix/rules/src/main/scala/fix/v0_7_0/AddMissingImports.scala
[info] Running scalafix on 173 Scala sources
[success] Total time: 16 s, completed Oct 17, 2018 12:01:31 PM

&gt; scalafix https://raw.githubusercontent.com/spotify/scio/main/scalafix/rules/src/main/scala/fix/v0_7_0/RewriteSysProp.scala
[info] Running scalafix on 173 Scala sources
[success] Total time: 6 s, completed Oct 17, 2018 12:34:00 PM

&gt; scalafix https://raw.githubusercontent.com/spotify/scio/main/scalafix/rules/src/main/scala/fix/v0_7_0/BQClientRefactoring.scala
[info] Running scalafix on 173 Scala sources
[success] Total time: 3 s, completed Oct 17, 2018 12:34:20 PM
</code></pre>
<p>At that point you can try to compile your code and fix the few compilation errors left. The next sections of this guide should contain all the information you need to fix everything.</p>
<h2><a href="#migration-guide" name="migration-guide" class="anchor"><span class="anchor-link"></span></a>Migration guide</h2>
<p>The following section will detail errors you may encounter while migrating from scio <code>0.6.x</code> to Scio <code>0.7.x</code>, and help you fix them. If you&rsquo;ve run the automated migration fixes, you can jump directly to the <strong>Add missing context bounds</strong> section.</p>
<h3><a href="#method-xxx-is-not-a-member-of-com-spotify-scio-sciocontext" name="method-xxx-is-not-a-member-of-com-spotify-scio-sciocontext" class="anchor"><span class="anchor-link"></span></a><code>method xxx is not a member of com.spotify.scio.ScioContext</code></h3>
<p>When using read methods from <code>ScioContext</code> the compiler may issue an error of type <code>method xxx is not a member of com.spotify.scio.ScioContext</code>.</p>
<p>IOs have been refactored in Scio <code>0.7.0</code>. Each IO type now lives in the appropriate project and package. It means 2 things:</p>
<h4><a href="#you-may-need-to-explicitly-add-a-dependency-one-of-scios-subprojects-in-your-build-file" name="you-may-need-to-explicitly-add-a-dependency-one-of-scios-subprojects-in-your-build-file" class="anchor"><span class="anchor-link"></span></a>You may need to explicitly add a dependency one of Scio&rsquo;s subprojects in your build file</h4>
<p>For example, Scio used to pull dependencies on BigQuery IOs even if your pipeline did not use BigQuery at all. With the new IOs, Scio will limit its dependencies to packages you actually use.</p>
<p>If your pipeline is using BigQuery, you now need to add <code>scio-bigquery</code> as a dependency of your project:</p>
<pre class="prettyprint"><code class="language-sbt">libraryDependencies += &quot;com.spotify&quot; %% &quot;scio-bigquery&quot; % scioVersion
</code></pre>
<h4><a href="#youll-need-to-import-the-appropriate-package-to-gain-access-to-the-io-methods-" name="youll-need-to-import-the-appropriate-package-to-gain-access-to-the-io-methods-" class="anchor"><span class="anchor-link"></span></a>You&rsquo;ll need to import the appropriate package to gain access to the IO methods.</h4>
<p>For example while migrating a job that reads data from an Avro file, you may see the following compiler error:</p>
<pre class="prettyprint"><code class="language-bash">[error] value avroFile is not a member of com.spotify.scio.ScioContext
[error]     val coll = sc.avroFile[SomeType](uri)
[error]                            ^
</code></pre>
<p>All you have to do to fix it is to import IOs from the correct package:</p>
<pre class="prettyprint"><code class="language-scala mdoc:silent">import com.spotify.scio.avro._
</code></pre>
<h3><a href="#avroio-or-other-type-of-io-not-found" name="avroio-or-other-type-of-io-not-found" class="anchor"><span class="anchor-link"></span></a><code>AvroIO</code> (or other type of IO) <code>not found</code></h3>
<p>IOs have been moved out of the <code>com.spotify.scio.testing</code> package. To use them in unit tests (or elsewhere), you&rsquo;ll need to change the import:</p>
<ul>
  <li><code>com.spotify.scio.testing.BigQueryIO</code> -&gt; <code>com.spotify.scio.bigquery.BigQueryIO</code></li>
  <li><code>com.spotify.scio.testing.{AvroIO, ProtobufIO}</code> -&gt; <code>com.spotify.scio.avro.{AvroIO, ProtobufIO}</code></li>
  <li><code>com.spotify.scio.testing.TextIO</code> -&gt; <code>com.spotify.scio.io.TextIO</code></li>
</ul>
<p>A complete list of IO packages can be found <a href="https://spotify.github.com/scio/internals/ScioIO">here</a>.</p>
<p>Additionally, some IOs are now parameterized. For example, <code>AvroIO</code> must now be parameterized with the Avro record type (either <code>GenericRecord</code> or an extension of <code>SpecificRecordBase</code>). In previous versions of Scio, it was possible in some cases to omit that type. For example:</p>
<pre class="prettyprint"><code class="language-scala mdoc:invisible">import org.apache.avro.generic.GenericRecord

object MyScioJob {}

val inputAUri = &quot;&quot;
val inputBUri = &quot;&quot;
val output = &quot;output&quot;

object Schemas {
  def record1: GenericRecord = ???
  def record2: GenericRecord = ???
}

implicit def bo: com.spotify.scio.testing.JobTest.BeamOptions = ??? // XXX: why do I need this ?
</code></pre>
<pre class="prettyprint"><code class="language-scala mdoc:fail:silent">import com.spotify.scio.io._
import com.spotify.scio.avro._
import com.spotify.scio.testing._

class MyScioJobTest extends PipelineSpec {

  &quot;MyScioJob&quot; should &quot;work&quot; in {
    JobTest[MyScioJob.type]
      .args(s&quot;--inputAUri=${inputAUri}&quot;)
      .args(s&quot;--inputBUri=${inputBUri}&quot;)
      .input(AvroIO[GenericRecord](inputAUri), Seq(Schemas.record1))
      .input(AvroIO[GenericRecord](inputBUri), Seq(Schemas.record2))
      .output(TextIO(output)){ coll =&gt;
        coll should haveSize (1)
        ()
      }
      .run()
  }

  // more tests
}
</code></pre>
<h4><a href="#avro-type-inference-issue-" name="avro-type-inference-issue-" class="anchor"><span class="anchor-link"></span></a>Avro type inference issue: &ldquo;diverging implicit expansion&rdquo;</h4>
<p>If you use <code>AvroIO</code> you may see the compilation of your tests failing with an error looking like</p>
<pre><code>[error] &lt;path&gt;/SomeTest.scala:42:20: diverging implicit expansion for type com.spotify.scio.coders.Coder[K]
[error] starting with macro method gen in trait LowPriorityCoderDerivation
[error]       .input(AvroIO(inputUri), inputs)
[error]
</code></pre>
<p>The problem is that line does not explicitly set the type of the IO:</p>
<pre class="prettyprint"><code class="language-scala">.input(AvroIO(inputUri), inputs)
</code></pre>
<p>In Scio &lt;= <code>0.6.x</code> this works, but in Scio <code>0.7.x</code>, you&rsquo;ll need to be explicit about the types. For example in that case:</p>
<pre class="prettyprint"><code class="language-scala">.input(AvroIO[GenericRecord](inputUri), inputs)
</code></pre>
<h3><a href="#bigquery-client" name="bigquery-client" class="anchor"><span class="anchor-link"></span></a>BigQuery client</h3>
<p>Client was renamed from <code>BigQueryClient</code> to <code>BigQuery</code>and relocated! Now you need to:</p>
<pre class="prettyprint"><code class="language-scala">import com.spotify.scio.bigquery.client.BigQuery
</code></pre>
<p>The new client offers now methods namespaced according to their resposabilities.</p>
<p>Methods typically fall into 4 categories of operations query, table, export and load. i.e:</p>
<pre class="prettyprint"><code class="language-diff">-client.extractLocation
+client.query.extracLocation

-client.getQuerySchema(...)
+client.query.schema(...)

-client.getTableRows(...)
+client.table.rows(...)

// the same thing applies for the other formats
-client.loadTableFromCsv(...)
+client.load.csv(...)

// the same thing applies for the other formats
-client.exportTableAsCsv(...)
+client.export.asCsv(...)
</code></pre>
<h3><a href="#not-enough-arguments-for-method-top-topbykey-approxquantilesbykey-implicit-ord-ordering-" name="not-enough-arguments-for-method-top-topbykey-approxquantilesbykey-implicit-ord-ordering-" class="anchor"><span class="anchor-link"></span></a>Not enough arguments for method (top|topByKey|approxQuantilesByKey): (implicit ord: Ordering[&hellip;])</h3>
<p>Explicit <code>Ordering</code> functions for <code>SCollection</code> reducers are no longer curried. Methods that used to look like:</p>
<pre class="prettyprint"><code class="language-scala">.top(10)(Ordering.by(...)
</code></pre>
<p>should be changed to:</p>
<pre class="prettyprint"><code class="language-scala">.top(10, Ordering.by(...))
</code></pre>
<h3><a href="#add-missing-context-bounds" name="add-missing-context-bounds" class="anchor"><span class="anchor-link"></span></a>Add missing context bounds</h3>
<p>In the process of upgrading Scio, you may encounter the following error:</p>
<blockquote>
  <p>Cannot find a Coder instance for type T</p>
</blockquote>
<p>If you&rsquo;ve defined a generic function that uses an <code>SCollection</code>, this function is likely to need a <code>Coder[T]</code>. Scio will require you to provide an implicit <code>Coder[T]</code>. You can read about Scala implicit parameters <a href="https://docs.scala-lang.org/tour/implicit-parameters.html">here</a></p>
<p>Let&rsquo;s see a simple example. Say I created the following method <code>doSomething</code>:</p>
<pre class="prettyprint"><code class="language-scala">def doSomething[T](coll: SCollection[T]): SCollection[T] =
  coll.map { t =&gt;
    // do something that returns a T
    val result: T = ???
    result
  }
</code></pre>
<p>If I try to compile this method the compiler will return the following error:</p>
<pre><code>Cannot find a Coder instance for type:

  &gt;&gt; T

  This can happen for a few reasons, but the most common case is that a data
  member somewhere within this type doesn&#39;t have a Coder instance in scope. Here are
  some debugging hints:
    - For Option types, ensure that a Coder instance is in scope for the non-Option version.
    - For List and Seq types, ensure that a Coder instance is in scope for a single element.
    - You can check that an instance exists for Coder in the REPL or in your code:
        scala&gt; Coder[Foo]
    And find the missing instance and construct it as needed.

  coll.map { t =&gt;
           ^
</code></pre>
<p>What this message says is that calling <code>.map { ... }</code> requires a <code>Coder[T]</code>. You can fix this very easily by adding a new implicit parameter to your method:</p>
<pre class="prettyprint"><code class="language-scala">import com.spotify.scio.coders.Coder
import com.spotify.scio.values.SCollection

def doSomething[T](coll: SCollection[T])(implicit coder: Coder[T]): SCollection[T] =
  coll.map { t =&gt;
    // do something that returns a T
    val result: T = ???
    result
  }
</code></pre>
<p>Alternatively, the same result can be achieved using Scala&rsquo;s context bound syntax:</p>
<pre class="prettyprint"><code class="language-scala">import com.spotify.scio.coders.Coder
import com.spotify.scio.values.SCollection

def doSomething[T: Coder](coll: SCollection[T]): SCollection[T] =
  coll.map { t =&gt;
    // do something that returns a T
    val result: T = ???
    result
  }
</code></pre>
<h3><a href="#replacing-kryo-fallbacks-with-your-own-coders-" name="replacing-kryo-fallbacks-with-your-own-coders-" class="anchor"><span class="anchor-link"></span></a>Replacing Kryo fallbacks with your own coders.</h3>
<p>Most of the time, the compiler will be able to find or derive an appropriate Coder automatically. Sometimes, it may not be able to find one automatically. This will typically happen for:</p>
<ul>
  <li>Classes defined in Java</li>
  <li>Scala classes that are not case classes</li>
  <li>Classes with a private constructor</li>
</ul>
<p>In those cases, Scio will fallback to using <a href="https://github.com/EsotericSoftware/kryo">Kryo</a>.</p>
<h4><a href="#showing-all-fallback-at-compile-time" name="showing-all-fallback-at-compile-time" class="anchor"><span class="anchor-link"></span></a>Showing all fallback at compile time</h4>
<p>The compiler can show a message each time a fallback is used. To activate that feature, just the the following scalac option: <code>-Xmacro-settings:show-coder-fallback=true</code>.</p>
<p>You can fix this warning in two ways:</p>
<ul>
  <li>Implement a proper <code>Coder</code> for this type</li>
  <li>Make it explicit that the <code>Kryo</code> coder is in fact the one you want to use.</li>
</ul>
<p>In both cases you want to define a Coder in your own code. The only difference is how you&rsquo;ll implement it.</p>
<p>Let&rsquo;s say you are using an <code>SCollection[java.util.Locale]</code>:</p>
<pre class="prettyprint"><code class="language-scala mdoc:reset:fail:silent">import com.spotify.scio.values.SCollection

def doSomething(coll: SCollection[String]): SCollection[java.util.Locale] =
  coll.map { t =&gt;
    // do something that returns a Locale
    val result: java.util.Locale = ???
    result
  }
</code></pre>
<h4><a href="#using-kryo-explicitly" name="using-kryo-explicitly" class="anchor"><span class="anchor-link"></span></a>Using Kryo explicitly</h4>
<p>If you want to explicitly use <code>Kryo</code> (which will probably be the case) you can do the following:</p>
<pre class="prettyprint"><code class="language-scala mdoc:reset:silent">import java.util.Locale
import com.spotify.scio.coders.Coder

object Coders {
  implicit val coderLocale: Coder[Locale] = Coder.kryo[Locale]
}
</code></pre>
<p>Now all you have to do is make that available at call site:</p>
<pre class="prettyprint"><code class="language-scala mdoc:silent">import com.spotify.scio.values.SCollection
import Coders._

def doSomething(coll: SCollection[String]): SCollection[java.util.Locale] =
  coll.map { t =&gt;
    // do something that returns a Locale
    val result: java.util.Locale = ???
    result
  }
</code></pre>
<h4><a href="#defining-a-custom-coder" name="defining-a-custom-coder" class="anchor"><span class="anchor-link"></span></a>Defining a custom <code>Coder</code></h4>
<p>If you want to implement custom coders, see Scio&rsquo;s source code for <a href="https://github.com/spotify/scio/tree/master/scio-core/src/main/scala/com/spotify/scio/coders/instances">examples</a>.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>Before implementing custom coders, we recommend that you test your pipeline with the default coders. Implementing custom coders can be tricky, so make sure there&rsquo;s a clear benefit in doing it. If you implement custom Coders, you need to make sure they are Serializable.</p></div>
<h3><a href="#wartremover-compatibility-" name="wartremover-compatibility-" class="anchor"><span class="anchor-link"></span></a>WartRemover compatibility.</h3>
<p>Automatically derived coders are generated by a macro. Unfortunately, if you use <a href="https://www.wartremover.org/">WartRemover</a> in your project, the macro will trigger warnings. There&rsquo;s not much we can do in the macro to fix the issue right now, so you&rsquo;ll have to disable a few warts. Here are the warts you&rsquo;ll need to disable in your project:</p>
<pre class="prettyprint"><code class="language-scala">- Any
- IsInstanceOf
- Throw
</code></pre>
<p>If you use <code>sbt-wartremover</code>, you can disable them in your build like this:</p>
<pre class="prettyprint"><code class="language-sbt">wartremoverErrors in (Compile, compile) := {
  val disableWarts = Set(
    Wart.Any,
    Wart.IsInstanceOf,
    Wart.Throw
  )
  Warts.unsafe.filterNot(disableWarts.contains)
},

wartremoverErrors in (Test, compile) := {
  val disableWarts = Set(
    Wart.Any,
    Wart.IsInstanceOf,
    Wart.Throw
  )
  Warts.unsafe.filterNot(disableWarts.contains)
}
</code></pre>
</div>
<div>
<a href="https://github.com/spotify/scio/tree/master/site/src/main/paradox/releases/migrations/v0.7.0-Migration-Guide.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.14.7-20-88d07bb-20240916T134149Z*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../releases/migrations/index.html" title="Migration Guides" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Migration Guides
</span>
</div>
</a>
<a href="../../releases/migrations/v0.8.0-Migration-Guide.html" title="Scio v0.8.0" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Scio v0.8.0
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright (C) 2024 Spotify AB
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://sbt.github.io/sbt-paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/spotify" class="md-footer-social__link fa fa-github"></a><a href="https://twitter.com/spotifyeng" class="md-footer-social__link fa fa-twitter"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
